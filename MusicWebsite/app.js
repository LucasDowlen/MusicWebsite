const musicList = [

    {
        song: "./songs/Imagine-Dragons-Bad-Liar.mp3",
        image: "https://external-content.duckduckgo.com/iu/?u=https%3A%2F%2Fmedia.deseretdigital.com%2Ffile%2F1158ef5291%3Fresize%3Dwidth_1200%26type%3Djpg%26c%3D21%26a%3De0717f4c&f=1&nofb=1",
        name: "Bad Liar",
        author: "Imagine Dragons"
    },

    {
        song: "./songs/Imagine-Dragons-Demons.mp3",
        image: "https://external-content.duckduckgo.com/iu/?u=https%3A%2F%2Fi.pinimg.com%2Foriginals%2F34%2Fca%2F78%2F34ca78256ed5d7e4c73c0b5779d09c3c.jpg&f=1&nofb=1",
        name: "Demons",
        author: "Imagine Dragons"
    },

    {
        song: "./songs/Imagine-Dragons-Thunder.mp3",
        image: "https://external-content.duckduckgo.com/iu/?u=http%3A%2F%2Fimages.genius.com%2F86e0d33ebe09cafa4e686ad0f38dc3df.1000x1000x1.jpg&f=1&nofb=1",
        name: "Thunder",
        author: "Imagine Dragons"
    },

    {
        song: "./songs/Amsterdam-ImagineDragons.mp3",
        image: "https://external-content.duckduckgo.com/iu/?u=http%3A%2F%2Fvol12.music-bazaar.com%2Falbum-images%2Fvol12%2F612%2F612173%2F2455908-big%2FNight-Visions-Best-Buy-Exclusive-Edition-cover.jpg&f=1&nofb=1",
        name: "Amsterdam",
        author: "Imagine Dragons"
    },

    {
        song: "./songs/Gold-ImagineDragons.mp3",
        image: "https://external-content.duckduckgo.com/iu/?u=http%3A%2F%2Fstatic.idolator.com%2Fuploads%2F2014%2F12%2FImagine-Dragons-Smoke-%252B-Mirrors-album-cover.jpg&f=1&nofb=1",
        name: "Gold",
        author: "Imagine Dragons"
    },

    {
        song: "./songs/NightVisions-ImagineDragons.mp3", //This is actually just a trailer, fix it!
        image: "https://external-content.duckduckgo.com/iu/?u=http%3A%2F%2Fvol12.music-bazaar.com%2Falbum-images%2Fvol12%2F612%2F612173%2F2455908-big%2FNight-Visions-Best-Buy-Exclusive-Edition-cover.jpg&f=1&nofb=1",
        name: "Night Visions",
        author: "Imagine Dragons"
    },

    {
        song: "./songs/OnTopOfTheWorld-ImagineDragons.mp3",
        image: "https://external-content.duckduckgo.com/iu/?u=http%3A%2F%2Ffarm9.staticflickr.com%2F8500%2F8323918886_1354132e2e_z.jpg&f=1&nofb=1",
        name: "On Top Of The World",
        author: "Imagine Dragons"
    },

    {
        song: "./songs/Shots-ImagineDragons.mp3",
        image: "https://upload.wikimedia.org/wikipedia/en/7/7d/Imagine_Dragons_-_Shots.png",
        name: "Shots",
        author: "Imagine Dragons"
    },

    {
        song: "./songs/Zero-ImagineDragons.mp3",
        image: "https://external-content.duckduckgo.com/iu/?u=https%3A%2F%2Fmedia.deseretdigital.com%2Ffile%2F1158ef5291%3Fresize%3Dwidth_1200%26type%3Djpg%26c%3D21%26a%3De0717f4c&f=1&nofb=1",
        name: "Zero",
        author: "Imagine Dragons"
    },

    {
        song: "./songs/BattleCry-ImagineDragons.mp3", //change image from here down for Imagine Dragons Songs.
        image: "https://external-content.duckduckgo.com/iu/?u=https%3A%2F%2Fmedia.deseretdigital.com%2Ffile%2F1158ef5291%3Fresize%3Dwidth_1200%26type%3Djpg%26c%3D21%26a%3De0717f4c&f=1&nofb=1",
        name: "BattleCry",
        author: "Imagine Dragons"
    },

    {
        song: "./songs/Friction-ImagineDragons.mp3",
        image: "https://external-content.duckduckgo.com/iu/?u=https%3A%2F%2Fmedia.deseretdigital.com%2Ffile%2F1158ef5291%3Fresize%3Dwidth_1200%26type%3Djpg%26c%3D21%26a%3De0717f4c&f=1&nofb=1",
        name: "Friction",
        author: "Imagine Dragons"
    },

    {
        song: "./songs/HearMe-ImagineDragons.mp3",
        image: "https://external-content.duckduckgo.com/iu/?u=https%3A%2F%2Fmedia.deseretdigital.com%2Ffile%2F1158ef5291%3Fresize%3Dwidth_1200%26type%3Djpg%26c%3D21%26a%3De0717f4c&f=1&nofb=1",
        name: "Hear Me",
        author: "Imagine Dragons"
    },
    
    {
        song: "./songs/HopelessOpus-ImagineDragons.mp3",
        image: "https://external-content.duckduckgo.com/iu/?u=https%3A%2F%2Fmedia.deseretdigital.com%2Ffile%2F1158ef5291%3Fresize%3Dwidth_1200%26type%3Djpg%26c%3D21%26a%3De0717f4c&f=1&nofb=1",
        name: "Hopeless Opus",
        author: "Imagine Dragons"
    },

    {
        song: "./songs/IDontKnowWhy-ImagineDragons.mp3",
        image: "https://external-content.duckduckgo.com/iu/?u=https%3A%2F%2Fmedia.deseretdigital.com%2Ffile%2F1158ef5291%3Fresize%3Dwidth_1200%26type%3Djpg%26c%3D21%26a%3De0717f4c&f=1&nofb=1",
        name: "I Don't Know Why",
        author: "Imagine Dragons"
    },

    {
        song: "./songs/ItsTime-ImagineDragons.mp3",
        image: "https://external-content.duckduckgo.com/iu/?u=https%3A%2F%2Fmedia.deseretdigital.com%2Ffile%2F1158ef5291%3Fresize%3Dwidth_1200%26type%3Djpg%26c%3D21%26a%3De0717f4c&f=1&nofb=1",
        name: "It's Time",
        author: "Imagine Dragons"
    },

    {
        song: "./songs/Levitate-ImagineDragons.mp3",
        image: "https://external-content.duckduckgo.com/iu/?u=https%3A%2F%2Fmedia.deseretdigital.com%2Ffile%2F1158ef5291%3Fresize%3Dwidth_1200%26type%3Djpg%26c%3D21%26a%3De0717f4c&f=1&nofb=1",
        name: "Levitate",
        author: "Imagine Dragons"
    },

    {
        song: "./songs/Monster-ImagineDragons.mp3",
        image: "https://external-content.duckduckgo.com/iu/?u=https%3A%2F%2Fmedia.deseretdigital.com%2Ffile%2F1158ef5291%3Fresize%3Dwidth_1200%26type%3Djpg%26c%3D21%26a%3De0717f4c&f=1&nofb=1",
        name: "Monster",
        author: "Imagine Dragons"
    },

    {
        song: "./songs/Roots-ImagineDragons.mp3",
        image: "https://external-content.duckduckgo.com/iu/?u=https%3A%2F%2Fmedia.deseretdigital.com%2Ffile%2F1158ef5291%3Fresize%3Dwidth_1200%26type%3Djpg%26c%3D21%26a%3De0717f4c&f=1&nofb=1",
        name: "Roots",
        author: "Imagine Dragons"
    },

    {
        song: "./songs/StartOver-ImagineDragons.mp3",
        image: "https://external-content.duckduckgo.com/iu/?u=https%3A%2F%2Fmedia.deseretdigital.com%2Ffile%2F1158ef5291%3Fresize%3Dwidth_1200%26type%3Djpg%26c%3D21%26a%3De0717f4c&f=1&nofb=1",
        name: "Start Over",
        author: "Imagine Dragons"
    },

    {
        song: "./songs/WalkingTheWire-ImagineDragons.mp3",
        image: "https://external-content.duckduckgo.com/iu/?u=https%3A%2F%2Fmedia.deseretdigital.com%2Ffile%2F1158ef5291%3Fresize%3Dwidth_1200%26type%3Djpg%26c%3D21%26a%3De0717f4c&f=1&nofb=1",
        name: "Walking The Wire",
        author: "Imagine Dragons"
    },

    {
        song: "./songs/Warriors-ImagineDragons.mp3",
        image: "https://external-content.duckduckgo.com/iu/?u=https%3A%2F%2Fmedia.deseretdigital.com%2Ffile%2F1158ef5291%3Fresize%3Dwidth_1200%26type%3Djpg%26c%3D21%26a%3De0717f4c&f=1&nofb=1",
        name: "Warriors",
        author: "Imagine Dragons"
    },

    {
        song: "./songs/Dean-Lewis-Waves.mp3",
        image: "https://external-content.duckduckgo.com/iu/?u=https%3A%2F%2Fimages.genius.com%2Fac3dfa8421c0500dbc07c386399c7765.1000x1000x1.jpg&f=1&nofb=1",
        name: "Waves",
        author: "Dean Lewis"
    },

    {
        song: "./songs/Dean-Lewis-Half-A-Man.mp3",
        image: "https://external-content.duckduckgo.com/iu/?u=https%3A%2F%2Fstatic.raru.co.za%2Fcover%2F2019%2F02%2F25%2F7184789-l.jpg%3Fv%3D1551049200&f=1&nofb=1",
        name: "Half A Man",
        author: "Dean Lewis"
    },

    {
        song: "./songs/Dean-Lewis-For-The-Last-Time.mp3",
        image: "https://external-content.duckduckgo.com/iu/?u=https%3A%2F%2Fstatic.raru.co.za%2Fcover%2F2019%2F02%2F25%2F7184789-l.jpg%3Fv%3D1551049200&f=1&nofb=1",
        name: "For The Last Time",
        author: "Dean Lewis"
    },

    {
        song: "./songs/Dean-Lewis-Stay-Awake.mp3",
        image: "https://external-content.duckduckgo.com/iu/?u=https%3A%2F%2Fimg.discogs.com%2FeRdMPYTDBNGs249jaXSdYBdFR6U%3D%2Ffit-in%2F300x300%2Ffilters%3Astrip_icc()%3Aformat(jpeg)%3Amode_rgb()%3Aquality(40)%2Fdiscogs-images%2FR-12531502-1537097487-9318.jpeg.jpg&f=1&nofb=1h",
        name: "Stay Awake",
        author: "Dean Lewis"
    },

    {
        song: "./songs/Dean-Lewis-A-Place-We-Knew.mp3",
        image: "https://external-content.duckduckgo.com/iu/?u=https%3A%2F%2Fstatic.raru.co.za%2Fcover%2F2019%2F02%2F25%2F7184789-l.jpg%3Fv%3D1551049200&f=1&nofb=1",
        name: "A Place We Knew",
        author: "Dean Lewis"
    }
];

var authorPlaylist = [];

var previousSongs = [];

var likedSongs = [];
var dislikedSongs = [];

var currentSong;
var songAudioComponent;
var songImage;
var songAuthor;
var songName;
var audio;
var icon;
var bar;

var randNumber;
var playing = false;
var skip;
var back;

var randOrderButton;
var songByArtistsButton;
var songAuthorsUl;
var stationType = musicList;
var stationName = musicList;

var opened = false;

var thumbsUp;
var thumbsDown;

let startWebsite = () => {

    grabComponents();

    randNumber = Math.floor(Math.random() * musicList.length);

    songImage.src = musicList[randNumber].image;
    songName.innerHTML = musicList[randNumber].name;
    songAuthor.innerHTML = musicList[randNumber].author;

    currentSong = musicList[randNumber];

    previousSongs.unshift(musicList[randNumber]);

    audio = new Audio(musicList[randNumber].song);
    icon.addEventListener("click", () => {
        if(playing === false){
            playing = true;
            audio.play();
            icon.classList.remove("fa-play-circle");
            icon.classList.add("fa-pause-circle");
        }
        else{
            playing = false;
            audio.pause();
            icon.classList.remove("fa-pause-circle");
            icon.classList.add("fa-play-circle");
        }
    });

    startingEventListeners();
}

let grabComponents = () => {
    songAudioComponent = document.querySelector('.song-audio');
    songImage = document.querySelector('.song-image');
    songAuthorsUl = document.querySelector('#songAuthorsUl');
    songAuthor = document.querySelector('.song-artist');
    songName = document.querySelector('.song-name');
    icon = document.querySelector('.play-icon');
    bar = document.querySelector('.bar');
    back = document.querySelector('.fa-backward');
    skip = document.querySelector('.fa-forward');
    
    randOrderButton = document.querySelector('#randomOrder');
    songByArtistsButton = document.querySelector('#ulContainer').children[0];

    thumbsUp = document.querySelector('.thumbsUp');
    thumbsDown = document.querySelector('.thumbsDown');
}

let startingEventListeners = () => {
    audio.addEventListener('timeupdate', () => bar.style.width = audio.currentTime / audio.duration * 251 + "px");

    skip.addEventListener('click', () => nextRandomSong(stationType));

    audio.addEventListener('ended', () => nextRandomSong(stationType));

    back.addEventListener('click', previousSong);

    document.querySelectorAll('.option').forEach(item => item.addEventListener('click', highlightOnClick));

    songByArtistsButton.addEventListener('click', () => openStationChoices(false));

    thumbsUp.addEventListener('click', thumbsUpClicked);
    thumbsDown.addEventListener('click', thumbsDownClicked);

    for (let i = 0; i < songAuthorsUl.children.length; i++) {
        songAuthorsUl.children[i].addEventListener('click', clicked);
    }

    for (let i = 0; i < songAuthorsUl.children.length; i++) {
        songAuthorsUl.children[i].addEventListener('click', subStationHoldSelection)
    }

    randOrderButton.addEventListener('click', () => {

        openStationChoices(true);

        if(stationType === musicList) return;

        stationName = musicList;
        stationType = musicList;
        nextRandomSong(stationType);
        removeHoldSelectionStyles();
    });

}

let checkThumbSelection = () => { //fix both selected glitch

    var songLiked = false;
    var songDisliked = false;

    for (let i = 0; i < likedSongs.length; i++) {
        if (currentSong === likedSongs[i]){
            thumbsUp.style.background = 'rgba(25, 45, 75, .2)';
            songLiked = true;
        }
    }

    if(!songLiked){
        thumbsUp.style.background = '';
    }


    for (let d = 0; d < dislikedSongs.length; d++) {
        if(currentSong === dislikedSongs[d]){
            thumbsDown.style.background = 'rgba(25, 45, 75, .2)';
            songDisliked = true;
        }
    }

    if(!songDisliked){
        thumbsDown.style.background = '';
    }
}

let thumbsUpClicked = () => { //i think spacing is done incorecctely
    thumbsUp.style.background = 'rgba(25, 45, 75, .2)';
    thumbsDown.style.background = '';

    var duplicate = false;

    for (let i = 0; i < likedSongs.length; i++) {
        if(currentSong === likedSongs[i]) {
            duplicate = true;
        }
    }

    if(duplicate === false) {
        likedSongs.unshift(currentSong);
    }

    for (let d = 0; d < dislikedSongs.length; d++) {
        if(currentSong === dislikedSongs[d]){

            console.log("Remove: " + dislikedSongs[d].name);

            dislikedSongs.splice(dislikedSongs[d], 1);

            console.log("should remove from diliked id = " + d);
        }

        console.log("DislikedSongs: ");
        console.log(dislikedSongs);
        console.log("Liked Songs: ");
        console.log(likedSongs);
    }
}

let thumbsDownClicked = () => {
    thumbsDown.style.background = 'rgba(25, 45, 75, .2)';
    thumbsUp.style.background = '';

    var duplicate = false;

    for (let d = 0; d < dislikedSongs.length; d++) {
        if(currentSong === dislikedSongs[d]) {
            duplicate = true;
        }
    }

    if(duplicate === false) {
        dislikedSongs.unshift(currentSong);
    }

    for (let i = 0; i < likedSongs.length; i++) {
        if(currentSong === likedSongs[i]){

            console.log("Remove: " + likedSongs[i].name);

            likedSongs.splice(likedSongs[i], 1);

            console.log("should remove from likedSongs id = " + i);
        }

        console.log("DislikedSongs: ");
        console.log(dislikedSongs);
        console.log("Liked Songs: ");
        console.log(likedSongs);
    }
}

function subStationHoldSelection() {
    removeHoldSelectionStyles();
    this.style.background = "rgba(73, 73, 158, .5)";
}

let removeHoldSelectionStyles = () => {
    for (let i = 0; i < songAuthorsUl.children.length; i++) {
        songAuthorsUl.children[i].style.background = '';
    }
}

function clicked(){

    if(stationName !== this.innerHTML){
        stationName = this.innerHTML;
        orderByAuthor(this.innerHTML);
        nextRandomSong(stationType);
    }
}

let openStationChoices = (closeWindow) => {
    if(opened === false && closeWindow === false){
        opened = true;

        for (let i = 0; i < songAuthorsUl.children.length; i++) {

            let style = songAuthorsUl.children[i].style;

            style.opacity = 1; 
            style.transform = 'translateY(0%)'; 
            style.pointerEvents = 'all'; 
        }
    }

    if(opened && closeWindow){
        opened = false;

        for (let i = 0; i < document.querySelector('#songAuthorsUl').children.length; i++) {

            let style = songAuthorsUl.children[i].style;

            style.transform = 'translateY(-90%)'; 
            style.opacity = 0; 
            style.pointerEvents = 'none'; 
        }
    }
}

let orderByAuthor = (selectedAuthor) => {

    authorPlaylist = [];

    for (let i = 0; i < musicList.length; i++) {
        
        if(musicList[i].author === selectedAuthor){
            authorPlaylist.push(musicList[i]);
        }
    }

    stationType = authorPlaylist;
}

function highlightOnClick(){
    document.querySelectorAll('.option').forEach(option => {
        option.children[0].style.background = '';
        option.children[0].style.borderRadius = '';   
    });
    
    this.children[0].style.background = "rgb(73, 112, 230)";
    this.children[0].style.borderRadius = "15px 0px";
}


let nextRandomSong = (list) => {

    audio.pause();
    audio.currentTime = 0;

    if(randNumber != null && randNumber > list.length - 1) {
        randNumber =  Math.floor(Math.random() * list.length);
    }

    randNumber +=  Math.floor(Math.random() * (list.length-1) + 1);

    if(randNumber >= list.length) randNumber -= list.length;

    currentSong = list[randNumber];

    audio.src = list[randNumber].song;
    audio.play();
    previousSongs.unshift(list[randNumber]);

    if(previousSongs.length > 20) previousSongs.pop();

    songName.innerHTML = list[randNumber].name;
    songAuthor.innerHTML = list[randNumber].author;
    songImage.src = list[randNumber].image;

    setIconToPause();

    checkThumbSelection();
}

let previousSong = () => {
    console.log("Previous Song ID: " + previousSongs.length);
    console.log(previousSongs);
    if(previousSongs.length === 1){
        console.log("Return");
        return;
    }

    audio.src = previousSongs[1].song;
    audio.play();

    songName.innerHTML = previousSongs[1].name;
    songAuthor.innerHTML = previousSongs[1].author;
    songImage.src = previousSongs[1].image;

    previousSongs.shift();

    setIconToPause();
}

let setIconToPause = () => {

    playing = true;

    if(icon.classList.contains("fa-play-circle"))
    {
        icon.classList.remove("fa-play-circle");
        icon.classList.add("fa-pause-circle");
    }
} 

window.onload = startWebsite;

//blaklksdjflkdjf